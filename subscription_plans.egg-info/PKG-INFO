Metadata-Version: 2.4
Name: subscription-plans
Version: 0.1.0
Summary: Streaming subscription plan generator with validation and FastAPI service.
Author: Streaming Plans Bot
License: MIT
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Requires-Dist: fastapi>=0.110.0
Requires-Dist: uvicorn>=0.27.0
Requires-Dist: pydantic>=2.6.0
Requires-Dist: pyyaml>=6.0.1
Requires-Dist: jsonschema>=4.21.0
Requires-Dist: httpx>=0.27.0
Provides-Extra: dev
Requires-Dist: pytest>=7.4.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.23.0; extra == "dev"

# Subscription Plan Generator

Streaming subscription plan generator that orchestrates retrieval-augmented prompting, JSON schema validation, automatic repair, and a FastAPI service layer. Designed for OTT/telco style pricing workflows.

## Features

- Retrieval of curated OTT plan examples to ground prompts.
- YAML drafting via GitHub Models (with offline-safe mock fallback).
- JSON Schema + cross-field validation (e.g., `Basic` plans limited to 1 device).
- Automatic repair cycle that re-prompts with validation feedback.
- A/B proposal generation with short stakeholder justification blurbs.
- FastAPI service exposing `/generate` and `/generate-ab` endpoints.
- Pytest suite and GitHub Actions CI workflow.

## Getting Started

1. Create and activate a virtual environment (Python 3.10+):

   ```bash
   python3 -m venv .venv
   . .venv/bin/activate
   ```

   (On Windows use `.venv\Scripts\activate`.)

2. Install dependencies:

   ```bash
   pip install -e .[dev]
   ```

3. Export a GitHub token with model access:

   ```bash
   export GITHUB_TOKEN=ghp_...
   ```

   The API first tries GitHub Models (`GITHUB_TOKEN` or `GH_TOKEN`); if unavailable it falls back to a static mock response (useful for offline/local development).

4. Run the API service:

   ```bash
   uvicorn subscription_plans.api:create_app --factory
   ```

5. Call the API:

   ```bash
   curl -X POST http://localhost:8000/generate \
     -H "Content-Type: application/json" \
     -d '{"prompt": "Launch plans for the US holiday season"}'
   ```

## Testing

```bash
python3 -m venv .venv
. .venv/bin/activate
pip install -e .[dev]
pytest
```

## Configuration Notes
- The pipeline configuration lives in `PlanGenerationConfig`. Adjust retries, example counts, or disable A/B generation as required.
- LLM client selection is automatic: GitHub Models (`gpt-4o-mini`) â†’ static mock. Override by supplying a custom `BaseLLMClient`.
- To integrate with GitHub Actions, see `.github/workflows/ci.yml`.
- For custom LLM providers, implement `BaseLLMClient.generate` and pass it into `create_app`.
